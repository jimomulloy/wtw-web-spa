<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Employee Directory</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

<!-- Optional theme -->
<link rel="stylesheet"
	href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">

<link href="css/styles.css" rel="stylesheet">

<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<style type="text/css">
hr {
	margin: 0 0;
}

#map_canvas_alt {
	width: 100%;
	height: 100%;
	min-height: 100%;
	display: block;
	border-radius: 10px;
	-webkit-border-radius: 10px;
}

#map_canvas {
	width: 500px;
	height: 400px;
	background-color: #CCC;
	min-height: 100%;
	display: block;
	border-radius: 10px;
	-webkit-border-radius: 10px;
}

.well {
	width: 100%;
	height: 100%;
	min-height: 100%;
}

.alert {
	border: 1px solid rgba(229, 223, 59, 0.78);
}
</style>

<script src="https://maps.googleapis.com/maps/api/js"></script>


<script type="text/javascript">
	function initialize() {
		var latlng = new google.maps.LatLng(51.4800, 0.00);
		var settings = {
			zoom : 10,
			center : latlng,
			mapTypeControl : false,
			mapTypeControlOptions : {
				style : google.maps.MapTypeControlStyle.DROPDOWN_MENU
			},
			navigationControl : true,
			navigationControlOptions : {
				style : google.maps.NavigationControlStyle.SMALL
			},
			mapTypeId : google.maps.MapTypeId.TERRAIN
		};

		var map = new google.maps.Map(document.getElementById("map_canvas"),
				settings);

		google.maps.event.addListener(map, 'click', function(event) {
			$('#latitude').val(event.latLng.lat());
			$('#longitude').val(event.latLng.lng());
		});

		var wespiMarker = new google.maps.Marker({
			position : latlng,
			map : map,
			title : "London, UK"
		});
		startws();

	}

	function startws() {
		var socket = new WebSocket("ws://api.cosm.com:8080");
		socket.onopen = function() {
			socket
					.send('{"method" : "subscribe", "resource" : "/feeds/129364", "headers" : {"X-ApiKey" : "AvKdOy4jlZ7QNRoJjwS_F6q30m-SAKw5S0JEdzZrT3NMZz0g"}}');
		}
		socket.onclose = function() {
			//try to reconnect in 5 seconds
			setTimeout(function() {
				startws()
			}, 5000);
		};

		socket.onmessage = function(msg) {
			var response = JSON.parse(msg.data);
			if ("body" in response) {
				var streams = response.body.datastreams;
				for (var i = 0; i < streams.length; i++) {
					st = streams[i];
					var prev = $("#" + st.id);
					var clone = prev.clone();
					clone.css('position', 'absolute');
					clone.css('left', prev.position().left);
					clone.css('top', prev.position().top);
					$('body').append(clone);
					prev.hide();
					if (st.unit) {
						prev.text(st.current_value + " " + st.unit.symbol);
					} else {
						prev.text(st.current_value);
					}
					clone.fadeOut(300, function() {
						clone.remove();
					});
					prev.fadeIn(300);
				}
			}
		};

	}

	google.maps.event.addDomListener(window, 'load', initialize);
</script>
</head>

<body>

	<div class="container">
		<div class="row-fluid">
			<div id="content" class="span12>"></div>
		</div>
	</div>
	
	<script src="http://use.edgefonts.net/source-sans-pro.js"></script>
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script
		src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script
		src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"
		type="text/javascript"></script>
	<script
		src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/0.9.2/backbone-min.js"
		type="text/javascript"></script>

	<!--script src="lib/jquery-1.9.1.min.js"></script>
	<script src="lib/underscore-min.js"></script>
	<script src="lib/backbone-min.js"></script>
	<script src="bootstrap/js/bootstrap.js"></script-->

	<script src="js/app.js"></script>
	<script src="js/views/shell.js"></script>
	<script src="js/views/home.js"></script>
	<script src="js/views/contact.js"></script>
	<script src="js/views/employeelist.js"></script>
	<script src="js/views/employeedetails.js"></script>

	<!-- SELECT ONE (AND ONLY ONE) OF THE DATA PERSISTENCE SOLUTIONS BELOW -->

	<!-- Uncomment the script below to access the application data using an in-memory data store -->
	<script src="js/models/model-in-memory.js"></script>

	<!-- Uncomment the script below to access the application data using RESTful services. Open model-rest.js and adjust the URL attributes to reflect your URL endpoints. -->
	<!--<script src="js/models/model-rest.js"></script>-->

	<!-- Uncomment the script below to access the application data using RESTful services with JSONP. Open model-rest.js and adjust the URL attributes to reflect your REST endpoints. -->
	<!--<script src="js/models/model-rest-jsonp.js"></script>-->

	<!-- Uncomment the two scripts below to use Parse.com as the data persistence layer. -->
	<!--<script src="lib/parse-1.2.2.min.js"></script>-->
	<!--<script src="js/models/model-parse-com.js"></script>-->
	<script type="text/javascript">
		$(document)
				.ready(
						function() {
							$('#geolocate')
									.click(
											function() {
												if (navigator.geolocation) {
													navigator.geolocation
															.getCurrentPosition(
																	geoSuccess,
																	geoError)
												} else {
													alert("Browser does not support geolocation");
												}
											});

							function geoSuccess(position) {
								alert("!!geo located");
								$('#latitude').val(position.coords.latitude);
								$('#longitude').val(position.coords.longitude);
							}

							function geoError(error) {
								switch (error.code) {
								case error.PERMISSION_DENIED:
									alert("Geolocate PERMISSION_DENIED: "
											+ error.message);
									break;
								case error.POSITION_UNAVAILABLE:
									alert("Geolocate POSITION_UNAVAILABLE: "
											+ error.message);
									break;
								case error.TIMEOUT:
									alert("Geolocate TIMEOUT: " + error.message);
									break;
								default:
									alert("Geolocate code " + error.code + ': '
											+ error.message);
									break;
								}
							}

						});
	</script>
	<script type="text/javascript">
		var GoSquared = {};
		GoSquared.acct = "GSN-287476-A";
		(function(w) {
			function gs() {
				w._gstc_lt = +new Date;
				var d = document, g = d.createElement("script");
				g.type = "text/javascript";
				g.src = "//d1l6p2sc9645hc.cloudfront.net/tracker.js";
				var s = d.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(g, s);
			}
			w.addEventListener ? w.addEventListener("load", gs, false) : w
					.attachEvent("onload", gs);
		})(window);
	</script>
	<script type="text/javascript">
		var _gauges = _gauges || [];
		(function() {
			var t = document.createElement('script');
			t.type = 'text/javascript';
			t.async = true;
			t.id = 'gauges-tracker';
			t.setAttribute('data-site-id', '510e99ccf5a1f50f85000093');
			t.src = '//secure.gaug.es/track.js';
			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(t, s);
		})();
	</script>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push([ '_setAccount', 'UA-38207510-1' ]);
		_gaq.push([ '_trackPageview' ]);

		(function() {
			var ga = document.createElement('script');
			ga.type = 'text/javascript';
			ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl'
					: 'http://www')
					+ '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0];
			s.parentNode.insertBefore(ga, s);
		})();
	</script>
</body>
</html>